name: Create Zeek release

on:
  workflow_dispatch:
    inputs:
      tag:
        required: true
        type: string

jobs:
  release:
    strategy:
      matrix:
        platform: [macos-12, ubuntu-20.04, windows-2019]
    runs-on: ${{ matrix.platform }}

    steps:
    - name: Checkout build-zeek
      uses: actions/checkout@v3

    - name: Checkout zeek
      uses: actions/checkout@v3
      with:
        repository: zeek/zeek
        ref: ${{ inputs.tag }}
        fetch-depth: 1
        submodules: recursive
        path: zeek

    - name: Setup Go on Windows
      if: startsWith(matrix.platform, 'windows-')
      uses: actions/setup-go@v3
      with:
        go-version-file: go.mod

    - name: Build zeekrunner for Windows
      if: startsWith(matrix.platform, 'windows-')
      run: go build -o zeekrunner.exe zeekrunner.go
